<template>
  <div>
    Items Number : <span class="snipcart-items-count" /> Items price:
    <span class="snipcart-total-price" />
    <button
      class="snipcart-add-item"
      v-bind="{
        ...$snipcart.customfields(product.customFields),
        ...$snipcart.bindProduct(product.data)
      }"
    >
      <!-- :data-item-id="product.id"
      :data-item-price="product.price"
      :data-item-url="product.storeUrl"
      :data-item-description="product.description"
      :data-item-name="product.title" -->
      Add to cart
    </button>
    <button class="snipcart-checkout">
      Click here to checkout
    </button>

    <button class="switch-lang" @click="switchLang">
      switch Lang
    </button>
    <button class="switch-currency" @click="switchCurrency('eur')">
      Change Currency to euros
    </button>
    <button class="switch-currency" @click="switchCurrency('usd')">
      Change Currency to dollars
    </button>
  </div>
</template>

<script>
export default {
  asyncData (context) {
    // console.log(context.app.$snipcart)
  },
  data: () => ({
    lang: 'fr',
    product: {
      data: {
        id: 42,
        price: 42,
        storeUrl: 'http://localhost:3000',
        name: 'awesome nuxt title',
        description: 'awesome nuxt description'
      },
      // https://docs.snipcart.com/v3/setup/products#1-dropdown
      customFields: [
        // dropdown
        {
          name: 'Frame color',
          options: 'Black|Brown|Gold'
        },
        // text note
        {
          name: 'Gift note'
        },
        // checkbox
        {
          name: 'Gift',
          type: 'checkbox'
        },
        // textarea
        {
          name: 'Long message',
          type: 'textarea'
        },
        // readonly
        {
          name: 'Readonly information',
          type: 'readonly',
          value: 'This is a readonly custom field'
        },
        // default value
        {
          name: 'awesome default value',
          options: 'Black|Brown[+100.00]|Gold[+300.00]',
          value: 'Brown'
        },
        // required
        {
          name: 'Special comments',
          type: 'textarea',
          required: 'true'
        },
        // placeholder
        {
          name: 'Engraving',
          placeholder: 'ex: John Doe'
        }
      ]
    },
    addItemEvent: null
  }),
  mounted () {
    document.addEventListener('snipcart.ready', function () {
      this.addItemEvent = window.Snipcart.events.on('item.added', (cartItem) => {
        // console.log(cartItem)
      })
    })
  },
  beforeDestroy () {
    this.addItemEvent.unsubscribe()
  },
  methods: {
    switchLang () {
      this.lang = this.lang === 'fr' ? 'en' : 'fr'
      this.$snipcart.setLanguage(this.lang)
    },
    switchCurrency (currency) {
      this.$snipcart.setCurrency(currency)
    }
  }
}
</script>
